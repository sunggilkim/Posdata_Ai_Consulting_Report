<!DOCTYPE html>
<html lang="ko">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일간 매출 분석 리포트</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; --card-bg: #fff; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        header { background: var(--primary); color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .header-info { text-align: right; font-size: 0.9rem; opacity: 0.9; }

        .card { background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; overflow: hidden; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary); font-size: 1.1rem; }

        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-box { background: #fff; padding: 20px; border-radius: 8px; text-align: center; border-left: 5px solid var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .up { color: #e74c3c; font-size: 0.8rem; font-weight: bold; } .down { color: #3498db; font-size: 0.8rem; font-weight: bold; }

        .charts-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        .chart-container { position: relative; height: 320px; width: 100%; }
        
        .assoc-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .assoc-box { flex: 1; min-width: 300px; }

        .table-wrapper { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 400px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; font-weight: 600; color: var(--primary); position: sticky; top: 0; }
        .text-right { text-align: right; }
        .badge { background: #e8f4fd; color: #2980b9; padding: 3px 8px; border-radius: 4px; font-size: 1rem; margin-right: 4px; font-weight: bold; display: inline-block; margin-bottom: 2px; }

        @media (max-width: 900px) {
            .charts-row { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }
        @media (max-width: 600px) {
            header { flex-direction: column; text-align: center; }
            .header-info { text-align: center; }
        }
        .ai-report-section { border-top: 4px solid var(--accent); }
        .ai-content { padding: 10px 5px; }
        .ai-content h3,.ai-content h4 { color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; }
        .ai-content p { margin-bottom: 10px; line-height: 1.8; color: #444; }
        .ai-content ul { padding-left: 20px; color: #555; }
        .ai-content li { margin-bottom: 8px; }
        .highlight-first td:nth-child(2) { 
            background-color: #fffce2 !important; 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="doc-title">로딩 중...</h1>
            <div class="header-info" id="doc-meta"></div>
        </header>

        <div class="summary-grid">
            <div class="stat-box">
                <div>총 매출</div>
                <div class="stat-val" id="total-sales">0</div>
                <div id="sales-growth"></div>
            </div>
            <div class="stat-box">
                <div>거래 건수</div>
                <div class="stat-val" id="trx-count">0</div>
                <div id="trx-growth"></div>
            </div>
            <div class="stat-box">
                <div>객단가</div>
                <div class="stat-val" id="atv">0</div>
                <div id="atv-growth"></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>7일간 매출 및 객단가 추이</h3>
                <div class="chart-container"><canvas id="trendChart"></canvas></div>
            </div>
            <div class="card">
                <h3>Top 10 카테고리 매출 비중</h3>
                <div class="chart-container"><canvas id="catPieChart"></canvas></div>
            </div>
            <div class="card full-width">
                <h3>시간대별 매출 및 객단가 상세</h3>
                <div class="chart-container"><canvas id="hourlyChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>시간대별 Top 5 카테고리</h3>
                <div class="table-wrapper" style="max-height:350px;">
                    <table id="hourly-top-table">
                        <thead>
                            <tr>
                                <th>시간대</th>
                                <th>1위 카테고리</th>
                                <th>2위 카테고리</th>
                                <th>3위 카테고리</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3>Top 10 상품</h3>
                <div class="table-wrapper" style="max-height:350px;">
                    <table id="top-prod-table">
                        <thead><tr><th>상품명</th><th class="text-right">매출</th><th class="text-right">수량</th><th class="text-right">점유율</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>카테고리 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-cat-table">
                        <thead><tr><th>카테고리</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3>상품 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-prod-table">
                        <thead><tr><th>상품명</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>연관 구매 분석</h3>
            <div class="assoc-container">
                <div class="assoc-box">
                    <h4>빈도별 연관구매 (자주 같이 구매)</h4>
                    <div class="table-wrapper"><table id="assoc-freq-table">
                        <thead><tr><th>조합</th><th class="text-right">Support</th><th class="text-right">Lift</th></tr></thead>
                        <tbody></tbody>
                    </table></div>
                </div>
                <div class="assoc-box">
                    <h4>매출별 연관구매 (매출 높은 조합)</h4>
                    <div class="table-wrapper"><table id="assoc-sales-table">
                        <thead><tr><th>조합</th><th class="text-right">매출합계</th><th class="text-right">Support</th></tr></thead>
                        <tbody></tbody>
                    </table></div>
                </div>
            </div>
        </div>
        <div class="card ai-report-section">
            <h3><span style="margin-right:8px;"></span>일간 데이터 기반 AI분석</h3>
            <div id="ai-insight-container" class="ai-content">
                <div id="ai-body"><h4>일일 실적 종합 진단</h4>
<ul>
<li>총매출(5,932,200원) 및 거래건수(598건)가 전일 대비 각각 <strong>9.7%, 14.2% 하락</strong>하며 토요일임에도 집객력이 약화된 <strong>주의</strong> 단계임. </li>
<li>반면, 객단가는 <strong>9,920원으로 전일 대비 5.25% 상승</strong>하며 최근 7일 중 가장 높은 수치를 기록함. 이는 방문객 감소를 고단가 상품(과일, 초밥 세트) 구매 확대로 방어한 결과로 해석됨.</li>
</ul>
<h4>시간대별 운영 효율</h4>
<ul>
<li>매출 및 객수 피크는 <strong>18:00-19:59</strong>에 집중(매출 비중 약 24%)되어 있으나, 객단가는 <strong>12:00-13:59(12,430원)</strong>에 가장 높음. </li>
<li>점심 시간대 고단가 델리 상품(초밥, 치킨) 수요가 확인되므로, 내일 해당 시간대에 계산대 혼잡을 막기 위한 사전 포장 및 <strong>'초밥+컵라면' 또는 '치킨+탄산' 세트화</strong>를 통해 결제 속도와 매출을 동시에 높여야 함.</li>
</ul>
<h4>상품 믹스 및 현장 연관 판매 (Daily MD)</h4>
<ul>
<li><strong>포도(샤인머스켓)</strong> 카테고리가 점유율 6.87%, 변동폭 2.7%로 급증함. 특히 샤인머스켓(팩)과 머스크메론의 상승세가 뚜렷하므로 <strong>내일 아침 최우선 발주 및 매장 입구 골든존 진열</strong>이 필요함.</li>
<li>연관 구매 분석 결과, <strong>스낵과 탄산(Lift 3.35)</strong>, <strong>스낵과 치킨(Lift 2.73)</strong>의 상관관계가 높음. 치킨 매대 바로 옆에 스낵 및 탄산음료를 배치하는 '연관 진열'이 시급함.</li>
<li><strong>밥류-컵라면(Lift 2.43)</strong> 조합도 유효함. 인기 품목인 '고기듬뿍 제육덮밥' 옆에 소용량 컵라면을 동시 진열하여 구매 단가 상승을 유도함.</li>
</ul>
<h4>종합 의견 - 내일 아침 즉시 실행 Action Plan</h4>
<ul>
<li><strong>과일 매대 전면 재정비</strong>: 오늘 판매가 급증한 샤인머스켓과 메론을 매장 입구에 배치하고, 연관도가 높은 수박/기타과일을 묶음 진열하여 과일 매출 극대화.</li>
<li><strong>저녁 피크(18시-20시) 인력 집중</strong>: 매출 비중이 가장 큰 시간대이므로 해당 시간대 계산대 대기 줄 관리 및 델리 코너 시식/권유 판매 인원을 배치할 것.</li>
<li><strong>교차 진열 실행</strong>: 치킨/초밥 매대 근처에 스낵과 소용량 음료를 배치하여 고객이 추가 상품을 자연스럽게 집을 수 있는 환경 조성.</li>
</ul></div>
            </div>
        </div>
    </div>

    <script>
        const data = {"문서 제목": "수영점 2025년 09월 20일 일일 매출 분석 보고서", "지점명": "수영점", "주차": "2025년 38주차", "날짜": "2025년 09월 20일", "요일": "토요일", "영업": true, "총매출": 5932200, "전일 대비 매출 상승율": -9.7, "거래건수": 598, "전일 대비 거래건수 상승율": -14.2, "객단가": 9920, "전일 대비 객단가 상승율": 5.25, "변동성 카테고리 top 5": [{"카테고리": "포도", "현재_점유율": 6.87, "변동폭": 2.7}, {"카테고리": "밥류", "현재_점유율": 7.63, "변동폭": -1.56}, {"카테고리": "양식", "현재_점유율": 1.36, "변동폭": 1.16}, {"카테고리": "유지류", "현재_점유율": 1.14, "변동폭": 1.14}, {"카테고리": "치킨", "현재_점유율": 4.49, "변동폭": 0.93}], "변동성 상품 top 5": [{"상품명": "샤인머스켓(팩)", "현재_점유율": 2.28, "변동폭": 2.28}, {"상품명": "머스크메론", "현재_점유율": 1.74, "변동폭": 0.67}, {"상품명": "샤인머스켓", "현재_점유율": 3.74, "변동폭": 0.6}, {"상품명": "배", "현재_점유율": 0.51, "변동폭": 0.51}, {"상품명": "나쵸 타코", "현재_점유율": 0.5, "변동폭": 0.5}], "7일간 매출 추이": {"2025-09-14": {"총매출": 5471320, "객단가": 9466}, "2025-09-15": {"총매출": 6957470, "객단가": 9155}, "2025-09-16": {"총매출": 6919820, "객단가": 9415}, "2025-09-17": {"총매출": 5693320, "객단가": 8587}, "2025-09-18": {"총매출": 6313320, "객단가": 8781}, "2025-09-19": {"총매출": 6569120, "객단가": 9425}, "2025-09-20": {"총매출": 5932200, "객단가": 9920}}, "시간대별 매출": [{"시간대": "08:00 - 09:59", "시간대별_총매출": 120480, "거래건수": 16, "객단가": 7530}, {"시간대": "10:00 - 11:59", "시간대별_총매출": 550680, "거래건수": 70, "객단가": 7867}, {"시간대": "12:00 - 13:59", "시간대별_총매출": 845220, "거래건수": 68, "객단가": 12430}, {"시간대": "14:00 - 15:59", "시간대별_총매출": 853820, "거래건수": 78, "객단가": 10946}, {"시간대": "16:00 - 17:59", "시간대별_총매출": 839370, "거래건수": 90, "객단가": 9326}, {"시간대": "18:00 - 19:59", "시간대별_총매출": 1429330, "거래건수": 128, "객단가": 11167}, {"시간대": "20:00 - 21:59", "시간대별_총매출": 962880, "거래건수": 107, "객단가": 8999}, {"시간대": "22:00 - 23:59", "시간대별_총매출": 330420, "거래건수": 41, "객단가": 8059}], "Top 10 카테고리 매출": [{"카테고리": "밥류", "순매출금": 452780, "순수량": 103, "점유율": 7.63, "Top 10 내 비중": 18.5}, {"카테고리": "포도", "순매출금": 407300, "순수량": 48, "점유율": 6.87, "Top 10 내 비중": 16.6}, {"카테고리": "초밥", "순매출금": 370740, "순수량": 50, "점유율": 6.25, "Top 10 내 비중": 15.1}, {"카테고리": "치킨", "순매출금": 266400, "순수량": 41, "점유율": 4.49, "Top 10 내 비중": 10.9}, {"카테고리": "계란", "순매출금": 185100, "순수량": 37, "점유율": 3.12, "Top 10 내 비중": 7.5}, {"카테고리": "기타과일", "순매출금": 184500, "순수량": 39, "점유율": 3.11, "Top 10 내 비중": 7.5}, {"카테고리": "스낵", "순매출금": 170590, "순수량": 73, "점유율": 2.88, "Top 10 내 비중": 7.0}, {"카테고리": "샐러드", "순매출금": 151900, "순수량": 46, "점유율": 2.56, "Top 10 내 비중": 6.2}, {"카테고리": "수박", "순매출금": 147900, "순수량": 34, "점유율": 2.49, "Top 10 내 비중": 6.0}, {"카테고리": "회", "순매출금": 116880, "순수량": 13, "점유율": 1.97, "Top 10 내 비중": 4.8}], "Top 10 카테고리 비중": 41.4, "시간대별 Top5 카테고리": [{"시간대": "08:00 - 09:59", "카테고리": "김밥", "순매출금": 17500, "매출순위": 1}, {"시간대": "08:00 - 09:59", "카테고리": "치킨", "순매출금": 14700, "매출순위": 2}, {"시간대": "08:00 - 09:59", "카테고리": "밥류", "순매출금": 8980, "매출순위": 3}, {"시간대": "08:00 - 09:59", "카테고리": "양념육", "순매출금": 8600, "매출순위": 4}, {"시간대": "08:00 - 09:59", "카테고리": "맥주", "순매출금": 8380, "매출순위": 5}, {"시간대": "10:00 - 11:59", "카테고리": "밥류", "순매출금": 88870, "매출순위": 1}, {"시간대": "10:00 - 11:59", "카테고리": "포도", "순매출금": 58900, "매출순위": 2}, {"시간대": "10:00 - 11:59", "카테고리": "초밥", "순매출금": 38450, "매출순위": 3}, {"시간대": "10:00 - 11:59", "카테고리": "샐러드", "순매출금": 33470, "매출순위": 4}, {"시간대": "10:00 - 11:59", "카테고리": "치킨", "순매출금": 29600, "매출순위": 5}, {"시간대": "12:00 - 13:59", "카테고리": "초밥", "순매출금": 68750, "매출순위": 1}, {"시간대": "12:00 - 13:59", "카테고리": "치킨", "순매출금": 54300, "매출순위": 2}, {"시간대": "12:00 - 13:59", "카테고리": "포도", "순매출금": 51900, "매출순위": 3}, {"시간대": "12:00 - 13:59", "카테고리": "밥류", "순매출금": 44400, "매출순위": 4}, {"시간대": "12:00 - 13:59", "카테고리": "계란", "순매출금": 42000, "매출순위": 5}, {"시간대": "14:00 - 15:59", "카테고리": "포도", "순매출금": 64900, "매출순위": 1}, {"시간대": "14:00 - 15:59", "카테고리": "밥류", "순매출금": 63240, "매출순위": 2}, {"시간대": "14:00 - 15:59", "카테고리": "초밥", "순매출금": 57840, "매출순위": 3}, {"시간대": "14:00 - 15:59", "카테고리": "수박", "순매출금": 39900, "매출순위": 4}, {"시간대": "14:00 - 15:59", "카테고리": "기타과일", "순매출금": 34500, "매출순위": 5}, {"시간대": "16:00 - 17:59", "카테고리": "밥류", "순매출금": 66560, "매출순위": 1}, {"시간대": "16:00 - 17:59", "카테고리": "초밥", "순매출금": 60350, "매출순위": 2}, {"시간대": "16:00 - 17:59", "카테고리": "계란", "순매출금": 52700, "매출순위": 3}, {"시간대": "16:00 - 17:59", "카테고리": "포도", "순매출금": 48000, "매출순위": 4}, {"시간대": "16:00 - 17:59", "카테고리": "치킨", "순매출금": 29600, "매출순위": 5}, {"시간대": "18:00 - 19:59", "카테고리": "포도", "순매출금": 97900, "매출순위": 1}, {"시간대": "18:00 - 19:59", "카테고리": "초밥", "순매출금": 96530, "매출순위": 2}, {"시간대": "18:00 - 19:59", "카테고리": "밥류", "순매출금": 89100, "매출순위": 3}, {"시간대": "18:00 - 19:59", "카테고리": "유지류", "순매출금": 40100, "매출순위": 4}, {"시간대": "18:00 - 19:59", "카테고리": "스낵", "순매출금": 38780, "매출순위": 5}, {"시간대": "20:00 - 21:59", "카테고리": "밥류", "순매출금": 74630, "매출순위": 1}, {"시간대": "20:00 - 21:59", "카테고리": "포도", "순매출금": 73700, "매출순위": 2}, {"시간대": "20:00 - 21:59", "카테고리": "치킨", "순매출금": 57600, "매출순위": 3}, {"시간대": "20:00 - 21:59", "카테고리": "기타과일", "순매출금": 43000, "매출순위": 4}, {"시간대": "20:00 - 21:59", "카테고리": "회", "순매출금": 42590, "매출순위": 5}, {"시간대": "22:00 - 23:59", "카테고리": "치킨", "순매출금": 22000, "매출순위": 1}, {"시간대": "22:00 - 23:59", "카테고리": "초밥", "순매출금": 19960, "매출순위": 2}, {"시간대": "22:00 - 23:59", "카테고리": "기타과일", "순매출금": 18500, "매출순위": 3}, {"시간대": "22:00 - 23:59", "카테고리": "돈육(수입산)", "순매출금": 18440, "매출순위": 4}, {"시간대": "22:00 - 23:59", "카테고리": "회", "순매출금": 17800, "매출순위": 5}], "Top 10 상품": [{"상품명": "샤인머스켓", "순매출금": 221600, "순수량": 28, "점유율": 3.74, "Top10내 비중": 20.6}, {"상품명": "수박", "순매출금": 147900, "순수량": 34, "점유율": 2.49, "Top10내 비중": 13.8}, {"상품명": "샤인머스켓(팩)", "순매출금": 135000, "순수량": 15, "점유율": 2.28, "Top10내 비중": 12.6}, {"상품명": "머스크메론", "순매출금": 103500, "순수량": 23, "점유율": 1.74, "Top10내 비중": 9.6}, {"상품명": "맛있는대란30구", "순매출금": 86900, "순수량": 11, "점유율": 1.46, "Top10내 비중": 8.1}, {"상품명": "모듬초밥패밀리세트", "순매출금": 85100, "순수량": 9, "점유율": 1.43, "Top10내 비중": 7.9}, {"상품명": "연어초밥 8P", "순매출금": 80910, "순수량": 9, "점유율": 1.36, "Top10내 비중": 7.5}, {"상품명": "고기듬뿍 제육덮밥", "순매출금": 75300, "순수량": 20, "점유율": 1.27, "Top10내 비중": 7.0}, {"상품명": "골든파인애플 (9수)", "순매출금": 75000, "순수량": 15, "점유율": 1.26, "Top10내 비중": 7.0}, {"상품명": "떡종류 균일가", "순매출금": 62500, "순수량": 25, "점유율": 1.05, "Top10내 비중": 5.8}], "빈도별 연관구매": [{"연관구매": ["스낵", "탄산"], "support": 0.02, "lift": 3.35}, {"연관구매": ["밥류", "컵라면"], "support": 0.02, "lift": 2.43}, {"연관구매": ["스낵", "치킨"], "support": 0.02, "lift": 2.73}, {"연관구매": ["기타과일", "수박"], "support": 0.02, "lift": 4.64}, {"연관구매": ["스낵", "쿠키/비스킷"], "support": 0.02, "lift": 5.18}], "매출별 연관구매": [{"연관구매": ["스낵", "치킨"], "총매출금": 263500, "support": 0.02}, {"연관구매": ["스낵", "탄산"], "총매출금": 238440, "support": 0.02}, {"연관구매": ["밥류", "치킨"], "총매출금": 222710, "support": 0.01}, {"연관구매": ["밥류", "컵라면"], "총매출금": 200480, "support": 0.02}, {"연관구매": ["기타과일", "수박"], "총매출금": 179590, "support": 0.02}], "회원 방문수": 140};

        if (!data) {
            alert("데이터를 찾을 수 없습니다.");
        }

        const fmt = (n) => new Intl.NumberFormat('ko-KR').format(n);
        const fmtWon = (n) => new Intl.NumberFormat('ko-KR', {style:'currency', currency:'KRW'}).format(n);
        
        // 변동폭 포맷 함수 (아이콘 및 색상 적용)
        const fmtChange = (val) => {
            const color = val >= 0 ? 'up' : 'down';
            const arrow = val >= 0 ? '▲' : '▼';
            return `<span class="${color}">${arrow} ${Math.abs(val)}%</span>`;
        };

        document.getElementById('doc-title').innerText = data["문서 제목"];
        document.getElementById('doc-meta').innerHTML = `${data["지점명"]} (${data["날짜"]} ${data["요일"]})<br>${data["주차"]} | 영업: ${data["영업"]?'ON':'OFF'}`;

        const setStat = (id, val, growthId, growthVal) => {
            document.getElementById(id).innerText = (id==='total-sales' || id==='atv') ? fmtWon(val) : fmt(val) + "건";
            const color = growthVal >= 0 ? 'up' : 'down';
            const arrow = growthVal >= 0 ? '▲' : '▼';
            document.getElementById(growthId).innerHTML = `전일대비 <span class="${color}">${Math.abs(growthVal)}% ${arrow}</span>`;
        };
        setStat('total-sales', data["총매출"], 'sales-growth', data["전일 대비 매출 상승율"]);
        setStat('trx-count', data["거래건수"], 'trx-growth', data["전일 대비 거래건수 상승율"]);
        setStat('atv', data["객단가"], 'atv-growth', data["전일 대비 객단가 상승율"]);

        // 차트 렌더링 생략 (기존 코드 유지)
        const trendLabels = Object.keys(data["7일간 매출 추이"]);
        const trendSales = trendLabels.map(date => data["7일간 매출 추이"][date].총매출);
        const trendATV = trendLabels.map(date => data["7일간 매출 추이"][date].객단가);

        new Chart(document.getElementById('trendChart'), {
            type: 'bar',
            data: {
                labels: trendLabels,
                datasets: [
                    { label: '매출액', data: trendSales, backgroundColor: '#b0d7ff', order: 2, yAxisID: 'y' },
                    { label: '객단가', data: trendATV, borderColor: '#e74c3c', backgroundColor: '#e74c3c', type: 'line', borderWidth: 3, pointRadius: 4, fill: false, order: 1, yAxisID: 'y1' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
                scales: { y: { type: 'linear', position: 'left' }, y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false } } }
            }
        });

        const catPieCtx = document.getElementById('catPieChart').getContext('2d');
        const centerTextPlugin = {
            id: 'centerText',
            afterDraw(chart) {
                const { ctx } = chart;
                ctx.save();
                const x = chart.getDatasetMeta(0).data[0].x;
                const y = chart.getDatasetMeta(0).data[0].y;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 12px Noto Sans KR'; ctx.fillStyle = '#666'; ctx.fillText('Top 10 비중', x, y - 15);
                ctx.font = 'bold 22px Noto Sans KR'; ctx.fillStyle = '#2c3e50'; ctx.fillText(data["Top 10 카테고리 비중"] + '%', x, y + 10);
                ctx.restore();
            }
        };

        new Chart(catPieCtx, {
            type: 'doughnut',
            data: {
                labels: data["Top 10 카테고리 매출"].map(d => d.카테고리),
                datasets: [{ data: data["Top 10 카테고리 매출"].map(d => d.순매출금), backgroundColor: ['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#34495e','#16a085','#27ae60','#2980b9','#8e44ad'], borderWidth: 2 }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 }, padding: 15 } } } },
            plugins: [centerTextPlugin]
        });

        new Chart(document.getElementById('hourlyChart'), {
            type: 'bar',
            data: {
                labels: data["시간대별 매출"].map(d => d.시간대.split(' ')[0]),
                datasets: [
                    { label: '매출', data: data["시간대별 매출"].map(d=>d.시간대별_총매출), backgroundColor: '#b0d7ff', order:2, yAxisID:'y' },
                    { label: '객단가', data: data["시간대별 매출"].map(d=>d.객단가), borderColor: '#e74c3c', type:'line', order:1, yAxisID:'y1' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { type:'linear', position:'left' }, y1: { type:'linear', position:'right', grid:{drawOnChartArea:false} } } }
        });

        const renderTable = (sel, list, rowHtmlInfo) => {
            const tbody = document.querySelector(sel + ' tbody');
            if(!list || list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="100%" style="text-align:center; padding:20px; color:#999;">데이터가 없습니다.</td></tr>';
                return;
            }
            list.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = rowHtmlInfo(item);
                tbody.appendChild(tr);
            });
        };

        const renderHourlyTop3 = (list) => {
            const tbody = document.querySelector('#hourly-top-table tbody');
            if (!list || list.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">데이터가 없습니다.</td></tr>'; return; }
            const grouped = list.reduce((acc, curr) => {
                if (!acc[curr.시간대]) acc[curr.시간대] = {};
                if (curr.매출순위 <= 3) acc[curr.시간대][curr.매출순위] = `${curr.카테고리} <br><small style="color:#666">(${fmt(curr.순매출금)}원)</small>`;
                return acc;
            }, {});
            Object.keys(grouped).sort().forEach(time => {
                const rowData = grouped[time];
                const tr = document.createElement('tr');
                tr.innerHTML = `<td style="font-weight:bold; vertical-align:middle;">${time}</td><td>${rowData[1] || '-'}</td><td>${rowData[2] || '-'}</td><td>${rowData[3] || '-'}</td>`;
                tbody.appendChild(tr);
            });
        };

        renderHourlyTop3(data["시간대별 Top5 카테고리"]);
        renderTable('#top-prod-table', data["Top 10 상품"], (i) => 
            `<td>${i.상품명}</td><td class="text-right">${fmt(i.순매출금)}</td><td class="text-right">${fmt(i.순수량)}</td><td class="text-right">${i.점유율}%</td>`
        );

        // --- 변동성 테이블 데이터 렌더링 추가 ---
        renderTable('#vol-cat-table', data["변동성 카테고리 top 5"], (i) => 
            `<td>${i.카테고리}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td>`
        );
        renderTable('#vol-prod-table', data["변동성 상품 top 5"], (i) => 
            `<td>${i.상품명}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td>`
        );

        renderTable('#assoc-freq-table', data["빈도별 연관구매"], (i) => 
            `<td>${i.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${i.support}</td><td class="text-right">${i.lift}</td>`
        );
        renderTable('#assoc-sales-table', data["매출별 연관구매"], (i) => 
            `<td>${i.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${fmt(i.총매출금)}</td><td class="text-right">${i.support}</td>`
        );
    </script>
</body>
</html>