<!DOCTYPE html>
<html lang="ko">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일간 매출 분석 리포트</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; --card-bg: #fff; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        header { background: var(--primary); color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .header-info { text-align: right; font-size: 0.9rem; opacity: 0.9; }

        .card { background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; overflow: hidden; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary); font-size: 1.1rem; }

        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-box { background: #fff; padding: 20px; border-radius: 8px; text-align: center; border-left: 5px solid var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .up { color: #e74c3c; font-size: 0.8rem; font-weight: bold; } .down { color: #3498db; font-size: 0.8rem; font-weight: bold; }

        .charts-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        .chart-container { position: relative; height: 320px; width: 100%; }
        
        .assoc-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .assoc-box { flex: 1; min-width: 300px; }

        .table-wrapper { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 400px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; font-weight: 600; color: var(--primary); position: sticky; top: 0; }
        .text-right { text-align: right; }
        .badge { background: #e8f4fd; color: #2980b9; padding: 3px 8px; border-radius: 4px; font-size: 1rem; margin-right: 4px; font-weight: bold; display: inline-block; margin-bottom: 2px; }

        @media (max-width: 900px) {
            .charts-row { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }
        @media (max-width: 600px) {
            header { flex-direction: column; text-align: center; }
            .header-info { text-align: center; }
        }
        .ai-report-section { border-top: 4px solid var(--accent); }
        .ai-content { padding: 10px 5px; }
        .ai-content h3,.ai-content h4 { color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; }
        .ai-content p { margin-bottom: 10px; line-height: 1.8; color: #444; }
        .ai-content ul { padding-left: 20px; color: #555; }
        .ai-content li { margin-bottom: 8px; }
        .highlight-first td:nth-child(2) { 
            background-color: #fffce2 !important; 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="doc-title">로딩 중...</h1>
            <div class="header-info" id="doc-meta"></div>
        </header>

        <div class="summary-grid">
            <div class="stat-box">
                <div>총 매출</div>
                <div class="stat-val" id="total-sales">0</div>
                <div id="sales-growth"></div>
            </div>
            <div class="stat-box">
                <div>거래 건수</div>
                <div class="stat-val" id="trx-count">0</div>
                <div id="trx-growth"></div>
            </div>
            <div class="stat-box">
                <div>객단가</div>
                <div class="stat-val" id="atv">0</div>
                <div id="atv-growth"></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>7일간 매출 및 객단가 추이</h3>
                <div class="chart-container"><canvas id="trendChart"></canvas></div>
            </div>
            <div class="card">
                <h3>Top 10 카테고리 매출 비중</h3>
                <div class="chart-container"><canvas id="catPieChart"></canvas></div>
            </div>
            <div class="card full-width">
                <h3>시간대별 매출 및 객단가 상세</h3>
                <div class="chart-container"><canvas id="hourlyChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>시간대별 Top 5 카테고리</h3>
                <div class="table-wrapper" style="max-height:350px;">
                    <table id="hourly-top-table">
                        <thead>
                            <tr>
                                <th>시간대</th>
                                <th>1위 카테고리</th>
                                <th>2위 카테고리</th>
                                <th>3위 카테고리</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3>Top 10 상품</h3>
                <div class="table-wrapper" style="max-height:350px;">
                    <table id="top-prod-table">
                        <thead><tr><th>상품명</th><th class="text-right">매출</th><th class="text-right">수량</th><th class="text-right">점유율</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>카테고리 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-cat-table">
                        <thead><tr><th>카테고리</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3>상품 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-prod-table">
                        <thead><tr><th>상품명</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>연관 구매 분석</h3>
            <div class="assoc-container">
                <div class="assoc-box">
                    <h4>빈도별 연관구매 (자주 같이 구매)</h4>
                    <div class="table-wrapper"><table id="assoc-freq-table">
                        <thead><tr><th>조합</th><th class="text-right">Support</th><th class="text-right">Lift</th></tr></thead>
                        <tbody></tbody>
                    </table></div>
                </div>
                <div class="assoc-box">
                    <h4>매출별 연관구매 (매출 높은 조합)</h4>
                    <div class="table-wrapper"><table id="assoc-sales-table">
                        <thead><tr><th>조합</th><th class="text-right">매출합계</th><th class="text-right">Support</th></tr></thead>
                        <tbody></tbody>
                    </table></div>
                </div>
            </div>
        </div>
        <div class="card ai-report-section">
            <h3><span style="margin-right:8px;"></span>일간 데이터 기반 AI분석</h3>
            <div id="ai-insight-container" class="ai-content">
                <div id="ai-body"><h4>일일 실적 종합 진단</h4>
<ul>
<li>10월 2일(목) 실적은 <strong>'주의'</strong> 단계임. 총매출은 전일 대비 <strong>18.91% 하락</strong>한 1,042만 원을 기록함.</li>
<li>거래건수는 <strong>8.73% 증가</strong>했음에도 불구하고, 객단가가 <strong>25.42% 급락(10,337원)</strong>하며 전체 매출 규모를 축소시킴. 이는 고객 방문은 늘었으나 장바구니당 구매 금액이 큰 폭으로 감소했음을 의미함.</li>
</ul>
<h4>시간대별 운영 효율</h4>
<ul>
<li>매출 피크(14~16시, 191만 원)와 객수 피크(18~20시, 181건)가 불일치함. 오후 시간대는 선물세트 등 고단가 상품 위주로 판매되었으나, 퇴근 시간대인 18시 이후에는 객단가가 8,413원까지 떨어지며 소액 구매가 집중됨.</li>
<li>내일 18시 이후 계산대 혼잡을 방지하기 위해 해당 시간대 인력을 보강하고, 계산대 인근에 <strong>스낵, 커피, 우유</strong> 등 회전율이 높고 연관 구매율이 높은 상품을 배치하여 추가 매출을 유도해야 함.</li>
</ul>
<h4>상품 믹스 및 현장 연관 판매 (Daily MD)</h4>
<ul>
<li><strong>선물세트</strong> 점유율이 9.13%p 급증하며 매출 비중 1위(11.79%)를 기록함. <strong>배선물세트 8~10과, 사과선물세트, CJ스팸복합S호</strong>의 판매가 활발하므로 내일 오전 중 해당 상품의 재고 확보 및 매장 전면 진열이 최우선임.</li>
<li><strong>상비약/건강보조식품</strong> 비중이 상승세(2.45%)임. 특히 <strong>정관장 홍삼원</strong>의 판매가 양호하므로 선물세트 구매 고객을 대상으로 한 연관 판매 추천이 효과적일 것임.</li>
<li>연관 구매 분석 결과 <strong>계란과 두부(Lift 3.67)</strong>, <strong>스낵과 쿠키(Lift 4.03)</strong>의 동시 구매 성향이 강함. 내일 아침 즉시 신선 매대에 계란과 두부를 인접 진열하고, 스낵 매대 중앙에 쿠키류를 혼합 배치할 것을 권고함.</li>
</ul>
<h4>종합 의견 - 내일 아침 즉시 실행 Action Plan</h4>
<ul>
<li><strong>선물세트 및 건강식품 전면 진열:</strong> 급증하는 명절 수요에 맞춰 선물세트 3종과 정관장 홍삼원의 진열 상태와 재고를 최우선으로 점검함.</li>
<li><strong>신선식품 연관 진열 수정:</strong> 계란 매대 바로 옆에 두부를 배치하여 동시 구매 편의성을 제공함.</li>
<li><strong>객수 피크 타임 응대 강화:</strong> 18시~20시 사이 계산대 대기 시간을 최소화하고, 계산대 앞 매대에 스낵류를 전진 배치하여 마지막 추가 구매 유도함.</li>
</ul></div>
            </div>
        </div>
    </div>

    <script>
        const data = {"문서 제목": "좌동점 2025년 10월 02일 일일 매출 분석 보고서", "지점명": "좌동점", "주차": "2025년 40주차", "날짜": "2025년 10월 02일", "요일": "목요일", "영업": true, "총매출": 10429570, "전일 대비 매출 상승율": -18.91, "거래건수": 1009, "전일 대비 거래건수 상승율": 8.73, "객단가": 10337, "전일 대비 객단가 상승율": -25.42, "변동성 카테고리 top 5": [{"카테고리": "선물세트", "현재_점유율": 11.79, "변동폭": 9.13}, {"카테고리": "쌀(백미)", "현재_점유율": 5.08, "변동폭": -1.99}, {"카테고리": "상비약/건강보조식품", "현재_점유율": 2.45, "변동폭": 1.77}, {"카테고리": "봉지라면", "현재_점유율": 2.33, "변동폭": -1.7}, {"카테고리": "계란", "현재_점유율": 4.38, "변동폭": -1.27}], "변동성 상품 top 5": [{"상품명": "배선물세트8~10과", "현재_점유율": 4.73, "변동폭": 4.53}, {"상품명": "사과선물세트15~16과", "현재_점유율": 1.48, "변동폭": 1.39}, {"상품명": "CJ스팸복합S호", "현재_점유율": 1.38, "변동폭": 1.38}, {"상품명": "농협)참햇쌀20kg", "현재_점유율": 5.08, "변동폭": -1.33}, {"상품명": "손잡이쓰레기봉투10L", "현재_점유율": 1.15, "변동폭": 1.15}], "7일간 매출 추이": {"2025-09-26": {"총매출": 11275060, "객단가": 10373}, "2025-09-27": {"총매출": 9880270, "객단가": 10154}, "2025-09-28": {"총매출": 8842360, "객단가": 9611}, "2025-09-29": {"총매출": 8771330, "객단가": 9156}, "2025-09-30": {"총매출": 10937240, "객단가": 10959}, "2025-10-01": {"총매출": 12862470, "객단가": 13860}, "2025-10-02": {"총매출": 10429570, "객단가": 10337}}, "시간대별 매출": [{"시간대": "08:00 - 09:59", "시간대별_총매출": 580600, "거래건수": 52, "객단가": 11165}, {"시간대": "10:00 - 11:59", "시간대별_총매출": 1245860, "거래건수": 113, "객단가": 11025}, {"시간대": "12:00 - 13:59", "시간대별_총매출": 1343500, "거래건수": 121, "객단가": 11103}, {"시간대": "14:00 - 15:59", "시간대별_총매출": 1919200, "거래건수": 146, "객단가": 13145}, {"시간대": "16:00 - 17:59", "시간대별_총매출": 1724930, "거래건수": 175, "객단가": 9857}, {"시간대": "18:00 - 19:59", "시간대별_총매출": 1522690, "거래건수": 181, "객단가": 8413}, {"시간대": "20:00 - 21:59", "시간대별_총매출": 1398020, "거래건수": 154, "객단가": 9078}, {"시간대": "22:00 - 23:59", "시간대별_총매출": 694770, "거래건수": 67, "객단가": 10370}], "Top 10 카테고리 매출": [{"카테고리": "선물세트", "순매출금": 1229700, "순수량": 45, "점유율": 11.79, "Top 10 내 비중": 28.9}, {"카테고리": "쌀(백미)", "순매출금": 530100, "순수량": 9, "점유율": 5.08, "Top 10 내 비중": 12.4}, {"카테고리": "계란", "순매출금": 457310, "순수량": 79, "점유율": 4.38, "Top 10 내 비중": 10.7}, {"카테고리": "포도", "순매출금": 434750, "순수량": 48, "점유율": 4.17, "Top 10 내 비중": 10.2}, {"카테고리": "커피", "순매출금": 284860, "순수량": 70, "점유율": 2.73, "Top 10 내 비중": 6.7}, {"카테고리": "흰우유", "순매출금": 283340, "순수량": 136, "점유율": 2.72, "Top 10 내 비중": 6.7}, {"카테고리": "스낵", "순매출금": 283180, "순수량": 175, "점유율": 2.72, "Top 10 내 비중": 6.6}, {"카테고리": "소주", "순매출금": 257260, "순수량": 107, "점유율": 2.47, "Top 10 내 비중": 6.0}, {"카테고리": "상비약/건강보조식품", "순매출금": 255450, "순수량": 14, "점유율": 2.45, "Top 10 내 비중": 6.0}, {"카테고리": "봉지라면", "순매출금": 243290, "순수량": 71, "점유율": 2.33, "Top 10 내 비중": 5.7}], "Top 10 카테고리 비중": 40.8, "시간대별 Top5 카테고리": [{"시간대": "08:00 - 09:59", "카테고리": "쌀(백미)", "순매출금": 58900, "매출순위": 1}, {"시간대": "08:00 - 09:59", "카테고리": "상온즉석식품", "순매출금": 52240, "매출순위": 2}, {"시간대": "08:00 - 09:59", "카테고리": "선물세트", "순매출금": 39900, "매출순위": 3}, {"시간대": "08:00 - 09:59", "카테고리": "쓰레기봉투", "순매출금": 36260, "매출순위": 4}, {"시간대": "08:00 - 09:59", "카테고리": "계란", "순매출금": 33440, "매출순위": 5}, {"시간대": "10:00 - 11:59", "카테고리": "선물세트", "순매출금": 200500, "매출순위": 1}, {"시간대": "10:00 - 11:59", "카테고리": "계란", "순매출금": 89850, "매출순위": 2}, {"시간대": "10:00 - 11:59", "카테고리": "쌀(백미)", "순매출금": 58900, "매출순위": 3}, {"시간대": "10:00 - 11:59", "카테고리": "김/해초류", "순매출금": 46170, "매출순위": 4}, {"시간대": "10:00 - 11:59", "카테고리": "봉지라면", "순매출금": 42980, "매출순위": 5}, {"시간대": "12:00 - 13:59", "카테고리": "선물세트", "순매출금": 356800, "매출순위": 1}, {"시간대": "12:00 - 13:59", "카테고리": "커피", "순매출금": 68970, "매출순위": 2}, {"시간대": "12:00 - 13:59", "카테고리": "포도", "순매출금": 65280, "매출순위": 3}, {"시간대": "12:00 - 13:59", "카테고리": "스낵", "순매출금": 44430, "매출순위": 4}, {"시간대": "12:00 - 13:59", "카테고리": "계란", "순매출금": 35940, "매출순위": 5}, {"시간대": "14:00 - 15:59", "카테고리": "선물세트", "순매출금": 169200, "매출순위": 1}, {"시간대": "14:00 - 15:59", "카테고리": "상비약/건강보조식품", "순매출금": 128580, "매출순위": 2}, {"시간대": "14:00 - 15:59", "카테고리": "계란", "순매출금": 123790, "매출순위": 3}, {"시간대": "14:00 - 15:59", "카테고리": "쓰레기봉투", "순매출금": 121030, "매출순위": 4}, {"시간대": "14:00 - 15:59", "카테고리": "쌀(백미)", "순매출금": 117800, "매출순위": 5}, {"시간대": "16:00 - 17:59", "카테고리": "선물세트", "순매출금": 180400, "매출순위": 1}, {"시간대": "16:00 - 17:59", "카테고리": "쌀(백미)", "순매출금": 117800, "매출순위": 2}, {"시간대": "16:00 - 17:59", "카테고리": "소주", "순매출금": 66270, "매출순위": 3}, {"시간대": "16:00 - 17:59", "카테고리": "흰우유", "순매출금": 63720, "매출순위": 4}, {"시간대": "16:00 - 17:59", "카테고리": "스낵", "순매출금": 62660, "매출순위": 5}, {"시간대": "18:00 - 19:59", "카테고리": "선물세트", "순매출금": 179100, "매출순위": 1}, {"시간대": "18:00 - 19:59", "카테고리": "포도", "순매출금": 101900, "매출순위": 2}, {"시간대": "18:00 - 19:59", "카테고리": "맥주", "순매출금": 70740, "매출순위": 3}, {"시간대": "18:00 - 19:59", "카테고리": "계란", "순매출금": 67880, "매출순위": 4}, {"시간대": "18:00 - 19:59", "카테고리": "커피", "순매출금": 56840, "매출순위": 5}, {"시간대": "20:00 - 21:59", "카테고리": "선물세트", "순매출금": 103800, "매출순위": 1}, {"시간대": "20:00 - 21:59", "카테고리": "포도", "순매출금": 65500, "매출순위": 2}, {"시간대": "20:00 - 21:59", "카테고리": "쌀(백미)", "순매출금": 58900, "매출순위": 3}, {"시간대": "20:00 - 21:59", "카테고리": "봉지라면", "순매출금": 56440, "매출순위": 4}, {"시간대": "20:00 - 21:59", "카테고리": "스낵", "순매출금": 51930, "매출순위": 5}, {"시간대": "22:00 - 23:59", "카테고리": "쌀(백미)", "순매출금": 117800, "매출순위": 1}, {"시간대": "22:00 - 23:59", "카테고리": "포도", "순매출금": 54900, "매출순위": 2}, {"시간대": "22:00 - 23:59", "카테고리": "계란", "순매출금": 41930, "매출순위": 3}, {"시간대": "22:00 - 23:59", "카테고리": "스낵", "순매출금": 35270, "매출순위": 4}, {"시간대": "22:00 - 23:59", "카테고리": "맥주", "순매출금": 31710, "매출순위": 5}], "Top 10 상품": [{"상품명": "농협)참햇쌀20kg", "순매출금": 530100, "순수량": 9, "점유율": 5.08, "Top10내 비중": 20.4}, {"상품명": "배선물세트8~10과", "순매출금": 493100, "순수량": 17, "점유율": 4.73, "Top10내 비중": 19.0}, {"상품명": "맛있는대란30구", "순매출금": 413310, "순수량": 69, "점유율": 3.96, "Top10내 비중": 15.9}, {"상품명": "샤인머스켓", "순매출금": 244000, "순수량": 31, "점유율": 2.34, "Top10내 비중": 9.4}, {"상품명": "연세)더클래식우유900ml", "순매출금": 224910, "순수량": 119, "점유율": 2.16, "Top10내 비중": 8.7}, {"상품명": "사과선물세트15~16과", "순매출금": 154800, "순수량": 3, "점유율": 1.48, "Top10내 비중": 6.0}, {"상품명": "하우스밀감", "순매출금": 150000, "순수량": 6, "점유율": 1.44, "Top10내 비중": 5.8}, {"상품명": "CJ스팸복합S호", "순매출금": 143600, "순수량": 4, "점유율": 1.38, "Top10내 비중": 5.5}, {"상품명": "정관장 홍삼원 50ml*30포", "순매출금": 124500, "순수량": 5, "점유율": 1.19, "Top10내 비중": 4.8}, {"상품명": "손잡이쓰레기봉투10L", "순매출금": 119540, "순수량": 278, "점유율": 1.15, "Top10내 비중": 4.6}], "빈도별 연관구매": [{"연관구매": ["스낵", "쿠키/비스킷"], "support": 0.02, "lift": 4.03}, {"연관구매": ["스낵", "흰우유"], "support": 0.01, "lift": 2.2}, {"연관구매": ["계란", "두부"], "support": 0.01, "lift": 3.67}, {"연관구매": ["맥주", "소주"], "support": 0.01, "lift": 3.36}, {"연관구매": ["곡물과자", "스낵"], "support": 0.01, "lift": 4.95}], "매출별 연관구매": [{"연관구매": ["스낵", "쿠키/비스킷"], "총매출금": 318780, "support": 0.02}, {"연관구매": ["계란", "두부"], "총매출금": 245540, "support": 0.01}, {"연관구매": ["스낵", "흰우유"], "총매출금": 237090, "support": 0.01}, {"연관구매": ["곡물과자", "스낵"], "총매출금": 162570, "support": 0.01}, {"연관구매": ["맥주", "소주"], "총매출금": 157590, "support": 0.01}], "회원 방문수": 399};

        if (!data) {
            alert("데이터를 찾을 수 없습니다.");
        }

        const fmt = (n) => new Intl.NumberFormat('ko-KR').format(n);
        const fmtWon = (n) => new Intl.NumberFormat('ko-KR', {style:'currency', currency:'KRW'}).format(n);
        
        // 변동폭 포맷 함수 (아이콘 및 색상 적용)
        const fmtChange = (val) => {
            const color = val >= 0 ? 'up' : 'down';
            const arrow = val >= 0 ? '▲' : '▼';
            return `<span class="${color}">${arrow} ${Math.abs(val)}%</span>`;
        };

        document.getElementById('doc-title').innerText = data["문서 제목"];
        document.getElementById('doc-meta').innerHTML = `${data["지점명"]} (${data["날짜"]} ${data["요일"]})<br>${data["주차"]} | 영업: ${data["영업"]?'ON':'OFF'}`;

        const setStat = (id, val, growthId, growthVal) => {
            document.getElementById(id).innerText = (id==='total-sales' || id==='atv') ? fmtWon(val) : fmt(val) + "건";
            const color = growthVal >= 0 ? 'up' : 'down';
            const arrow = growthVal >= 0 ? '▲' : '▼';
            document.getElementById(growthId).innerHTML = `전일대비 <span class="${color}">${Math.abs(growthVal)}% ${arrow}</span>`;
        };
        setStat('total-sales', data["총매출"], 'sales-growth', data["전일 대비 매출 상승율"]);
        setStat('trx-count', data["거래건수"], 'trx-growth', data["전일 대비 거래건수 상승율"]);
        setStat('atv', data["객단가"], 'atv-growth', data["전일 대비 객단가 상승율"]);

        // 차트 렌더링 생략 (기존 코드 유지)
        const trendLabels = Object.keys(data["7일간 매출 추이"]);
        const trendSales = trendLabels.map(date => data["7일간 매출 추이"][date].총매출);
        const trendATV = trendLabels.map(date => data["7일간 매출 추이"][date].객단가);

        new Chart(document.getElementById('trendChart'), {
            type: 'bar',
            data: {
                labels: trendLabels,
                datasets: [
                    { label: '매출액', data: trendSales, backgroundColor: '#b0d7ff', order: 2, yAxisID: 'y' },
                    { label: '객단가', data: trendATV, borderColor: '#e74c3c', backgroundColor: '#e74c3c', type: 'line', borderWidth: 3, pointRadius: 4, fill: false, order: 1, yAxisID: 'y1' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
                scales: { y: { type: 'linear', position: 'left' }, y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false } } }
            }
        });

        const catPieCtx = document.getElementById('catPieChart').getContext('2d');
        const centerTextPlugin = {
            id: 'centerText',
            afterDraw(chart) {
                const { ctx } = chart;
                ctx.save();
                const x = chart.getDatasetMeta(0).data[0].x;
                const y = chart.getDatasetMeta(0).data[0].y;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 12px Noto Sans KR'; ctx.fillStyle = '#666'; ctx.fillText('Top 10 비중', x, y - 15);
                ctx.font = 'bold 22px Noto Sans KR'; ctx.fillStyle = '#2c3e50'; ctx.fillText(data["Top 10 카테고리 비중"] + '%', x, y + 10);
                ctx.restore();
            }
        };

        new Chart(catPieCtx, {
            type: 'doughnut',
            data: {
                labels: data["Top 10 카테고리 매출"].map(d => d.카테고리),
                datasets: [{ data: data["Top 10 카테고리 매출"].map(d => d.순매출금), backgroundColor: ['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#34495e','#16a085','#27ae60','#2980b9','#8e44ad'], borderWidth: 2 }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 }, padding: 15 } } } },
            plugins: [centerTextPlugin]
        });

        new Chart(document.getElementById('hourlyChart'), {
            type: 'bar',
            data: {
                labels: data["시간대별 매출"].map(d => d.시간대.split(' ')[0]),
                datasets: [
                    { label: '매출', data: data["시간대별 매출"].map(d=>d.시간대별_총매출), backgroundColor: '#b0d7ff', order:2, yAxisID:'y' },
                    { label: '객단가', data: data["시간대별 매출"].map(d=>d.객단가), borderColor: '#e74c3c', type:'line', order:1, yAxisID:'y1' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { type:'linear', position:'left' }, y1: { type:'linear', position:'right', grid:{drawOnChartArea:false} } } }
        });

        const renderTable = (sel, list, rowHtmlInfo) => {
            const tbody = document.querySelector(sel + ' tbody');
            if(!list || list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="100%" style="text-align:center; padding:20px; color:#999;">데이터가 없습니다.</td></tr>';
                return;
            }
            list.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = rowHtmlInfo(item);
                tbody.appendChild(tr);
            });
        };

        const renderHourlyTop3 = (list) => {
            const tbody = document.querySelector('#hourly-top-table tbody');
            if (!list || list.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">데이터가 없습니다.</td></tr>'; return; }
            const grouped = list.reduce((acc, curr) => {
                if (!acc[curr.시간대]) acc[curr.시간대] = {};
                if (curr.매출순위 <= 3) acc[curr.시간대][curr.매출순위] = `${curr.카테고리} <br><small style="color:#666">(${fmt(curr.순매출금)}원)</small>`;
                return acc;
            }, {});
            Object.keys(grouped).sort().forEach(time => {
                const rowData = grouped[time];
                const tr = document.createElement('tr');
                tr.innerHTML = `<td style="font-weight:bold; vertical-align:middle;">${time}</td><td>${rowData[1] || '-'}</td><td>${rowData[2] || '-'}</td><td>${rowData[3] || '-'}</td>`;
                tbody.appendChild(tr);
            });
        };

        renderHourlyTop3(data["시간대별 Top5 카테고리"]);
        renderTable('#top-prod-table', data["Top 10 상품"], (i) => 
            `<td>${i.상품명}</td><td class="text-right">${fmt(i.순매출금)}</td><td class="text-right">${fmt(i.순수량)}</td><td class="text-right">${i.점유율}%</td>`
        );

        // --- 변동성 테이블 데이터 렌더링 추가 ---
        renderTable('#vol-cat-table', data["변동성 카테고리 top 5"], (i) => 
            `<td>${i.카테고리}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td>`
        );
        renderTable('#vol-prod-table', data["변동성 상품 top 5"], (i) => 
            `<td>${i.상품명}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td>`
        );

        renderTable('#assoc-freq-table', data["빈도별 연관구매"], (i) => 
            `<td>${i.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${i.support}</td><td class="text-right">${i.lift}</td>`
        );
        renderTable('#assoc-sales-table', data["매출별 연관구매"], (i) => 
            `<td>${i.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${fmt(i.총매출금)}</td><td class="text-right">${i.support}</td>`
        );
    </script>
</body>
</html>