<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주간 매출 분석 보고서</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #2c3e50; 
            --accent: #3498db; 
            --bg: #f4f7f6; 
            --card-bg: #fff; 
            --highlight: #fffce2; 
        }
        * { box-sizing: border-box; }
        
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; width: 100%; } 
        
        header { background: var(--primary); color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px; }
        header h1 { margin: 0; font-size: 1.5rem; }

        .card { background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 20px; margin-bottom: 20px; width: 100%; height: 100%; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary); font-size: 1.1rem; }
        
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #fff; padding: 20px; border-radius: 8px; text-align: center; border-top: 5px solid var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--primary); margin: 8px 0; }

        .charts-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        
        @media (max-width: 1000px) { .charts-row { grid-template-columns: 1fr; } .full-width { grid-column: span 1; } }

        .chart-container { position: relative; height: 350px; width: 100%; }
        
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 500px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; font-weight: 600; }

        .highlight-first td:nth-child(2) { background-color: var(--highlight); font-weight: bold; }
        
        .text-right { text-align: right; }
        .badge { background: #e8f4fd; color: #2980b9; padding: 3px 8px; border-radius: 4px; font-weight: bold; margin-right: 5px; font-size: 0.85rem; }

        .basket-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .basket-item { background: #f9f9f9; padding: 12px; border-radius: 6px; text-align: center; border: 1px solid #eee; }
        .basket-label { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .basket-val { font-size: 1.1rem; font-weight: bold; color: var(--accent); }

        /* 변동폭 색상 추가 */
        .up { color: #e74c3c; font-weight: bold; }
        .down { color: #3498db; font-weight: bold; }

        /* --- AI Report Section Styles (Daily와 동일하게 변경) --- */
        .ai-report-section { border-top: 4px solid var(--accent); }
        .ai-content { padding: 10px 5px; }
        .ai-content h3, .ai-content h4 { color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; }
        .ai-content p { margin-bottom: 10px; line-height: 1.8; color: #444; }
        .ai-content ul { padding-left: 20px; color: #555; }
        .ai-content li { margin-bottom: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="doc-title">주간 매출 분석 보고서</h1>
            <div id="doc-meta" style="text-align: right; opacity: 0.9;"></div>
        </header>

        <div class="summary-grid">
            <div class="stat-box"><div>주간 총매출</div><div class="stat-val" id="total-sales">0</div><div id="sales-growth"></div></div>
            <div class="stat-box"><div>평균 일일매출</div><div class="stat-val" id="avg-daily-sales">0</div><div id="avg-sales-growth"></div></div>
            <div class="stat-box"><div>평균 일일 거래건수</div><div class="stat-val" id="avg-trx">0</div><div id="trx-growth"></div></div>
            <div class="stat-box"><div>평균 일일 객단가</div><div class="stat-val" id="avg-atv">0</div><div id="atv-growth"></div></div>
        </div>

        <div class="charts-row">
            <div class="card"><h3>5주간 매출 추이</h3><div class="chart-container"><canvas id="fiveWeekChart"></canvas></div></div>
            <div class="card"><h3>요일별 매출 (전주 비교)</h3><div class="chart-container"><canvas id="dayCompareChart"></canvas></div></div>
            <div class="card full-width"><h3>주간 시간대별 매출 및 객단가</h3><div class="chart-container"><canvas id="hourlyWeeklyChart"></canvas></div></div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>요일별 Top 3 카테고리</h3>
                <div class="table-wrapper"><table id="day-top-table" class="highlight-first">
                    <thead><tr><th>요일</th><th>1위</th><th>2위</th><th>3위</th></tr></thead><tbody></tbody>
                </table></div>
            </div>
            <div class="card">
                <h3>주간 시간대별 Top 3 카테고리</h3>
                <div class="table-wrapper"><table id="hour-top-table" class="highlight-first">
                    <thead><tr><th>시간대</th><th>1위</th><th>2위</th><th>3위</th></tr></thead><tbody></tbody>
                </table></div>
            </div>
            <div class="card"><h3>주간 전체 Top 10 카테고리</h3><div class="chart-container"><canvas id="weeklyCatChart"></canvas></div></div>
            <div class="card">
                <h3>주간 Top 10 상품</h3>
                <div class="table-wrapper"><table id="top-item-table"><thead><tr><th>상품명</th><th class="text-right">매출액</th><th class="text-right">수량</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card">
                <h3>주간 카테고리 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-cat-table">
                        <thead><tr><th>카테고리</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3>주간 상품 변동성 Top 5</h3>
                <div class="table-wrapper">
                    <table id="vol-prod-table">
                        <thead><tr><th>상품명</th><th class="text-right">현재 점유율</th><th class="text-right">변동폭</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card ai-report-section">
            <h3>주간 매출 및 변동성 분석</h3>
            <div class="ai-content">
                <div id="ai-space-1"><h4>주간 실적 종합 진단</h4>
<ul>
<li>매출 흐름: 5주간 매출 추이는 전주 정점 달성 후 급격한 <strong>하락 반전</strong> 상태임. 전주 대비 객수(-19.57%)보다 <strong>객단가(-23.33%)</strong>의 하락폭이 더 커, 대량 구매 고객 감소가 실적 악화의 핵심 원인으로 진단됨.</li>
<li>요일별 분석: 전주 대비 매출 갭이 가장 큰 요일은 <strong>수요일</strong>임. 주력 카테고리인 <strong>계란, 쌀(백미), 봉지라면</strong>의 실적 방어 실패가 수요일 매출 급락(약 -642만 원)을 견인함.</li>
<li>총평: <strong>생필품 및 고단가 품목 구매 감소로 인한 객단가 하락 및 매출 성장세 급감.</strong></li>
</ul>
<h4>상품 및 카테고리 심층 분석</h4>
<ul>
<li>수익원(Cash Cow): <strong>맥주(12.45%)</strong>, <strong>봉지라면(11.07%)</strong>, <strong>계란(11.01%)</strong>이 전체 매출의 약 35%를 차지하며 안정적인 매출 기반을 형성하고 있음.</li>
<li>리스크 관리: <strong>쌀(백미)</strong>과 <strong>포도/토마토</strong> 카테고리는 판매 수량은 적으나 단가가 높아 매출 변동성을 키우는 요소임. 특히 쌀은 수량 17건으로 매출 5.87%를 차지하므로, 재고 부족 시 매출 타격이 크므로 상시 재고 확보가 필수적임.</li>
</ul>
<h4>운영 효율화 전략</h4>
<ul>
<li>골든타임 대응: 주간 매출 피크 타임은 <strong>16:00 - 17:59</strong>임. 해당 시간대 매출 비중이 높은 <strong>맥주, 소주, 봉지라면</strong>을 집중 배치하여 구매 편의성을 높여야 함.</li>
<li>인력/진열 제안: 실적이 높은 <strong>금요일과 토요일 16:00 - 20:00</strong>에 인력을 집중 배치함. 모든 주류 및 스낵류 진열은 골든타임 시작 전인 <strong>15시 30분</strong>까지 완료하여 피크 타임 대응력을 강화함.</li>
</ul>
<h4>차주 중점 과제</h4>
<ul>
<li>재고: 매출 비중이 높은 <strong>맥주, 봉지라면, 맛있는대란30구</strong>의 결품 방지를 위한 발주 관리 철저.</li>
<li>진열: 16시 이전 <strong>주류 및 연관 안주류(스낵)</strong> 전면 진열 및 매대 보충 완료.</li>
<li>접객: 16시~20시 집중 대응 및 주류 구매 고객 대상 <strong>스낵류 연관 구매 유도</strong> 멘트 적극 활용.</li>
</ul></div>
            </div>
        </div>

        <div class="card">
            <h3>연관구매 분석</h3>
            <div class="charts-row">
                <div class="table-wrapper"><h4>빈도별 연관구매 (Top 5)</h4><table id="assoc-freq-table"><thead><tr><th>조합</th><th class="text-right">Support</th><th class="text-right">Lift</th></tr></thead><tbody></tbody></table></div>
                <div class="table-wrapper"><h4>매출별 연관구매 (Top 5)</h4><table id="assoc-sales-table"><thead><tr><th>조합</th><th class="text-right">총매출금</th></tr></thead><tbody></tbody></table></div>
            </div>
            <div class="table-wrapper" style="margin-top:20px;">
                <h4>주간 객단가별 연관구매 Top 3</h4>
                <table id="atv-assoc-table" class="highlight-first"><thead><tr><th>객단가 범위</th><th>1위 조합</th><th>2위 조합</th><th>3위 조합</th></tr></thead><tbody></tbody></table>
            </div>
        </div>

        <div class="card ai-report-section">
            <h3>구매 패턴 및 연관성 분석</h3>
            <div class="ai-content">
                <div id="ai-space-2"><h4>장바구니 조합 및 구매 패턴 분석</h4>
<ul>
<li><strong>빈도 중심(Support):</strong> '스낵+쿠키/비스킷'(0.024) 및 '맥주+소주'(0.021)가 가장 보편적인 구매 패턴임. 기호식품 위주의 동반 구매가 주류를 이룸.</li>
<li><strong>강도 중심(Lift):</strong> <strong>'오이+호박'(7.41)</strong> 조합이 가장 강력한 연관성을 보임. 구매 빈도는 낮으나 식재료 간 보완 관계가 뚜렷하여, 해당 품목 구매 시 교차 구매 확률이 매우 높음을 시사함.</li>
</ul>
<h4>매출 기여도 및 앵커(Anchor) 분석</h4>
<ul>
<li><strong>수익 기여 조합:</strong> '스낵+쿠키/비스킷' 조합이 약 <strong>172만 원</strong>의 매출을 기록하며 시너지가 극대화됨.</li>
<li><strong>앵커 카테고리:</strong> <strong>'스낵'</strong>은 탄산, 우유, 맥주, 라면 등과 결합하며 전 카테고리 판매를 견인하는 핵심 앵커임.</li>
<li><strong>연계 미흡 지적:</strong> 매출 상위권인 <strong>'포도(샤인머스켓)' 및 '토마토'</strong>는 연관 구매 데이터에서 제외됨. 현재 단독 구매 성향이 강하므로, 스낵이나 유제품 코너에 소포장 과일을 병행 진열하여 연계성을 강화해야 함.</li>
</ul>
<h4>객단가 구간별 이동 전략</h4>
<ul>
<li><strong>구간별 특징:</strong> 2만 원 미만은 주류 및 간식 위주이며, 4만 원 이상 고단가 구간은 계란, 라면 등 생필품 중심임.</li>
<li><strong>상승 전략:</strong> 저단가 주류 구매 고객에게 고매출 과일류(포도 등)를 디저트로 제안하거나, 4만 원 이상 구매 시 '아이스크림' 등 저단가 기호식품 증정/할인을 통해 추가 구매 유도.</li>
</ul>
<h4>현장 실행 액션 플랜</h4>
<ul>
<li><strong>홈술 폭탄주 번들:</strong> 매출 점유율이 높은 <strong>맥주와 소주</strong>를 결합한 할인 패키지 구성으로 주류 매출 극대화.</li>
<li><strong>간편 한 끼 번들:</strong> 고단가 구간 필수품인 <strong>'맛있는대란30구'와 '봉지라면'</strong>을 묶음 진열하여 주부 및 1인 가구의 동시 구매 유도.</li>
</ul></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="card"><h3>주간 회원 연령대 분포</h3><div class="chart-container"><canvas id="ageChart"></canvas></div></div>
            <div class="card"><h3>주간 회원 방문횟수</h3><div class="chart-container"><canvas id="visitChart"></canvas></div></div>
            <div class="card"><h3>주간 회원 Top 10 카테고리</h3><div class="chart-container"><canvas id="memberCatChart"></canvas></div></div>
            <div class="card"><h3>주간 회원 객단가 분포</h3><div class="chart-container"><canvas id="atvDistChart"></canvas></div></div>
            
            <div class="card">
                <h3>주간 회원 장바구니 통계</h3>
                <div id="basket-container"></div>
            </div>
            <div class="card">
                <h3>주간 회원 나이대별 Top 3 카테고리</h3>
                <div class="table-wrapper"><table id="age-cat-table" class="highlight-first">
                    <thead><tr><th>연령대</th><th>1위</th><th>2위</th><th>3위</th></tr></thead><tbody></tbody>
                </table></div>
            </div>
        </div>

        <div class="card ai-report-section">
            <h3>고객 특성 및 행동 분석</h3>
            <div class="ai-content">
                <div id="ai-space-3"><h4>핵심 고객 페르소나 정의</h4>
<ul>
<li><strong>주력 고객(4050 여성):</strong> 매장 매출의 핵심인 4050 세대는 <strong>계란(매출 1위), 우유, 스낵</strong> 등 가족 단위 부식과 신선 식품을 대량 소비함. 주간 방문 1회 비중이 높아 장바구니 규모가 큰 편임.</li>
<li><strong>틈새 고객(60대 실버층):</strong> 4050 다음으로 높은 비중을 차지하며, <strong>봉지라면과 쌀(백미)</strong> 등 저장성 생필품에 소비가 집중됨. 객단가 기여도가 높으므로 이들을 위한 무거운 품목 배송 서비스나 대용량 기획이 유효함.</li>
</ul>
<h4>세대별 소비 패턴 및 공략 전략</h4>
<ul>
<li><strong>소비 격차:</strong> 2030은 상온즉석식품 등 편의성 위주, 4050은 식재료와 맥주(유흥), 6070은 양곡과 계절 과일(포도) 선호가 뚜렷함.</li>
<li><strong>맞춤 전략:</strong> <ul>
<li>2030: 퇴근 시간대(18~20시) 즉석식품 타임 세일. </li>
<li>4050: <strong>맥주+스낵 번들 할인</strong> 프로모션. </li>
<li>6070: 쌀, 라면 구매 시 <strong>배달 서비스</strong> 우선권 부여.</li>
</ul>
</li>
</ul>
<h4>방문 빈도 및 객단가 기반 등급 관리</h4>
<ul>
<li><strong>재방문 유도(Frequency):</strong> 현재 1회 방문자가 700명으로 압도적임. 이들의 재방문을 위해 <strong>'3일 내 재방문 시 계란/우유 추가 할인'</strong> 쿠폰을 발행하여 방문 회수를 2회 이상으로 유도해야 함.</li>
<li><strong>객단가 상승(Monetary):</strong> 중앙값(7,950원) 대비 1만 원 미만 결제가 60% 이상으로, <strong>1만 원의 심리적 저항선</strong>이 존재함. '1.5만 원 이상 구매 시 스낵 증정' 등 문턱을 낮춘 증정 행사를 통해 객단가 상향을 도모함.</li>
</ul>
<h4>CRM 액션 플랜 (문자 마케팅)</h4>
<ul>
<li><strong>타겟 1 (4050 주부층):</strong> 계란, 우유 등 핵심 신선식품 구매 고객.<ul>
<li>[좌동점] 사장님! 오늘 <strong>맛있는대란 30구</strong> 특가 알림! 가족 건강 챙기고 우유 할인권도 받아가세요.</li>
</ul>
</li>
<li><strong>타겟 2 (60대 실버층):</strong> 쌀, 라면 등 대량 생필품 구매 고객.<ul>
<li>[좌동점] 무거운 <strong>햇쌀 20kg</strong>, 집 앞까지 배달해 드립니다! 봉지라면 번들 할인 혜택도 놓치지 마세요.</li>
</ul>
</li>
</ul></div>
            </div>
        </div>
    </div>

    <script>
        const data = {"문서 제목": "좌동점 2025-10-06 주간 매출 분석 보고서", "지점명": "좌동점", "주차": "2025-41주차", "주 시작일": "2025-10-06", "주 종료일": "2025-10-12", "영업일수": 7, "주간 총매출": 44044090, "전주 대비 매출 상승율": -38.35, "평균 일일 매출": 6292013, "전주 대비 평균 일일 매출 상승율": -38.35, "평균 일일 거래건수": 748, "전주 대비 거래건수 상승율": -19.57, "평균 일일 객단가": 8415, "전주 대비 객단가 상승율": -23.33, "5주간 매출 추이": {"2025-09-08~2025-09-14,2025-37주차": 54216010, "2025-09-15~2025-09-21,2025-38주차": 49523720, "2025-09-22~2025-09-28,2025-39주차": 59196670, "2025-09-29~2025-10-05,2025-40주차": 71442690, "2025-10-06~2025-10-12,2025-41주차": 44044090}, "요일별 매출(전 주 비교)": {"월요일": {"2025-09-29~2025-10-05": 8771330, "2025-10-06~2025-10-12": 4451290}, "화요일": {"2025-09-29~2025-10-05": 10937240, "2025-10-06~2025-10-12": 5489920}, "수요일": {"2025-09-29~2025-10-05": 12862470, "2025-10-06~2025-10-12": 6439560}, "목요일": {"2025-09-29~2025-10-05": 10429570, "2025-10-06~2025-10-12": 5699850}, "금요일": {"2025-09-29~2025-10-05": 8442140, "2025-10-06~2025-10-12": 7624710}, "토요일": {"2025-09-29~2025-10-05": 10112040, "2025-10-06~2025-10-12": 7778270}, "일요일": {"2025-09-29~2025-10-05": 9887900, "2025-10-06~2025-10-12": 6560490}}, "변동성 카테고리 top 5": [{"카테고리": "쌀(백미)", "현재_점유율": 5.87, "변동폭": -3.96}, {"카테고리": "토마토", "현재_점유율": 4.37, "변동폭": 3.96}, {"카테고리": "포도", "현재_점유율": 8.13, "변동폭": -3.5}, {"카테고리": "봉지라면", "현재_점유율": 11.07, "변동폭": 3.45}, {"카테고리": "권장소비자가", "현재_점유율": 6.2, "변동폭": 3.27}], "변동성 상품 top 5": [{"상품명": "대추방울토마토(기획)", "현재_점유율": 7.19, "변동폭": 6.51}, {"상품명": "샤인머스켓", "현재_점유율": 7.46, "변동폭": -5.18}, {"상품명": "맛있는대란30구", "현재_점유율": 18.75, "변동폭": 4.77}, {"상품명": "농협)참햇쌀20kg", "현재_점유율": 11.02, "변동폭": -3.78}, {"상품명": "아이스크림바균일가", "현재_점유율": 3.25, "변동폭": 3.03}], "주간 시간대별 평균 매출": [{"시간대": "06:00 - 07:59", "총매출": 27650, "평균매출": 3950, "총거래건수": 5, "평균객단가": 5530}, {"시간대": "08:00 - 09:59", "총매출": 2216500, "평균매출": 316643, "총거래건수": 241, "평균객단가": 9197}, {"시간대": "10:00 - 11:59", "총매출": 4891250, "평균매출": 698750, "총거래건수": 505, "평균객단가": 9686}, {"시간대": "12:00 - 13:59", "총매출": 4383310, "평균매출": 626187, "총거래건수": 579, "평균객단가": 7570}, {"시간대": "14:00 - 15:59", "총매출": 5988730, "평균매출": 855533, "총거래건수": 698, "평균객단가": 8580}, {"시간대": "16:00 - 17:59", "총매출": 8943570, "평균매출": 1277653, "총거래건수": 1020, "평균객단가": 8768}, {"시간대": "18:00 - 19:59", "총매출": 7592510, "평균매출": 1084644, "총거래건수": 955, "평균객단가": 7950}, {"시간대": "20:00 - 21:59", "총매출": 6359590, "평균매출": 908513, "총거래건수": 810, "평균객단가": 7851}, {"시간대": "22:00 - 23:59", "총매출": 3640980, "평균매출": 520140, "총거래건수": 421, "평균객단가": 8648}], "주간 Top 10 카테고리 매출": [{"카테고리": "맥주", "순매출금": 1890650, "순수량": 811, "점유율": 12.45}, {"카테고리": "봉지라면", "순매출금": 1680530, "순수량": 434, "점유율": 11.07}, {"카테고리": "계란", "순매출금": 1671200, "순수량": 260, "점유율": 11.01}, {"카테고리": "스낵", "순매출금": 1608920, "순수량": 1052, "점유율": 10.6}, {"카테고리": "소주", "순매출금": 1389900, "순수량": 662, "점유율": 9.16}, {"카테고리": "흰우유", "순매출금": 1338430, "순수량": 527, "점유율": 8.82}, {"카테고리": "포도", "순매출금": 1234280, "순수량": 120, "점유율": 8.13}, {"카테고리": "권장소비자가", "순매출금": 941190, "순수량": 1265, "점유율": 6.2}, {"카테고리": "쌀(백미)", "순매출금": 891190, "순수량": 17, "점유율": 5.87}, {"카테고리": "토마토", "순매출금": 663880, "순수량": 72, "점유율": 4.37}], "요일별 Top5 카테고리": {"월요일": [{"카테고리": "선물세트", "순매출금": 331200}, {"카테고리": "맥주", "순매출금": 237640}, {"카테고리": "포도", "순매출금": 188200}, {"카테고리": "소주", "순매출금": 186120}, {"카테고리": "수입술", "순매출금": 178990}], "화요일": [{"카테고리": "맥주", "순매출금": 313450}, {"카테고리": "권장소비자가", "순매출금": 282880}, {"카테고리": "스낵", "순매출금": 269570}, {"카테고리": "흰우유", "순매출금": 219540}, {"카테고리": "계란", "순매출금": 215410}], "수요일": [{"카테고리": "계란", "순매출금": 304800}, {"카테고리": "쌀(백미)", "순매출금": 287500}, {"카테고리": "봉지라면", "순매출금": 274500}, {"카테고리": "맥주", "순매출금": 250330}, {"카테고리": "스낵", "순매출금": 237080}], "목요일": [{"카테고리": "봉지라면", "순매출금": 327550}, {"카테고리": "스낵", "순매출금": 265080}, {"카테고리": "맥주", "순매출금": 262090}, {"카테고리": "계란", "순매출금": 244010}, {"카테고리": "권장소비자가", "순매출금": 180200}], "금요일": [{"카테고리": "봉지라면", "순매출금": 306550}, {"카테고리": "계란", "순매출금": 301430}, {"카테고리": "흰우유", "순매출금": 282900}, {"카테고리": "스낵", "순매출금": 259610}, {"카테고리": "맥주", "순매출금": 254650}], "토요일": [{"카테고리": "맥주", "순매출금": 307510}, {"카테고리": "토마토", "순매출금": 297730}, {"카테고리": "계란", "순매출금": 297140}, {"카테고리": "소주", "순매출금": 285980}, {"카테고리": "흰우유", "순매출금": 284080}], "일요일": [{"카테고리": "맥주", "순매출금": 264980}, {"카테고리": "쌀(백미)", "순매출금": 247500}, {"카테고리": "소주", "순매출금": 207750}, {"카테고리": "계란", "순매출금": 199700}, {"카테고리": "포도", "순매출금": 199480}]}, "주간 시간대별 Top3 카테고리": [{"시간대": "06:00 - 07:59", "카테고리": "떠먹는요구르트", "순매출금": 14460}, {"시간대": "06:00 - 07:59", "카테고리": "설탕", "순매출금": 5490}, {"시간대": "06:00 - 07:59", "카테고리": "얼음", "순매출금": 2590}, {"시간대": "08:00 - 09:59", "카테고리": "계란", "순매출금": 179720}, {"시간대": "08:00 - 09:59", "카테고리": "쌀(백미)", "순매출금": 163700}, {"시간대": "08:00 - 09:59", "카테고리": "쓰레기봉투", "순매출금": 135080}, {"시간대": "10:00 - 11:59", "카테고리": "봉지라면", "순매출금": 242340}, {"시간대": "10:00 - 11:59", "카테고리": "계란", "순매출금": 215660}, {"시간대": "10:00 - 11:59", "카테고리": "쌀(백미)", "순매출금": 123800}, {"시간대": "12:00 - 13:59", "카테고리": "포도", "순매출금": 167700}, {"시간대": "12:00 - 13:59", "카테고리": "봉지라면", "순매출금": 139710}, {"시간대": "12:00 - 13:59", "카테고리": "계란", "순매출금": 109530}, {"시간대": "12:00 - 13:59", "카테고리": "권장소비자가", "순매출금": 109530}, {"시간대": "14:00 - 15:59", "카테고리": "맥주", "순매출금": 196010}, {"시간대": "14:00 - 15:59", "카테고리": "스낵", "순매출금": 156250}, {"시간대": "14:00 - 15:59", "카테고리": "계란", "순매출금": 154560}, {"시간대": "16:00 - 17:59", "카테고리": "맥주", "순매출금": 416390}, {"시간대": "16:00 - 17:59", "카테고리": "소주", "순매출금": 255990}, {"시간대": "16:00 - 17:59", "카테고리": "봉지라면", "순매출금": 253760}, {"시간대": "18:00 - 19:59", "카테고리": "맥주", "순매출금": 372180}, {"시간대": "18:00 - 19:59", "카테고리": "스낵", "순매출금": 337430}, {"시간대": "18:00 - 19:59", "카테고리": "계란", "순매출금": 209290}, {"시간대": "20:00 - 21:59", "카테고리": "맥주", "순매출금": 335930}, {"시간대": "20:00 - 21:59", "카테고리": "포도", "순매출금": 198290}, {"시간대": "20:00 - 21:59", "카테고리": "스낵", "순매출금": 195870}, {"시간대": "22:00 - 23:59", "카테고리": "맥주", "순매출금": 210370}, {"시간대": "22:00 - 23:59", "카테고리": "쌀(백미)", "순매출금": 185700}, {"시간대": "22:00 - 23:59", "카테고리": "계란", "순매출금": 128810}], "주간 Top 10 상품": [{"상품명": "맛있는대란30구", "순매출금": 1369450, "순수량": 205, "점유율": 18.75}, {"상품명": "농협)참햇쌀20kg", "순매출금": 804700, "순수량": 13, "점유율": 11.02}, {"상품명": "연세)더클래식우유900ml", "순매출금": 788040, "순수량": 396, "점유율": 10.79}, {"상품명": "샤인머스켓", "순매출금": 545200, "순수량": 51, "점유율": 7.46}, {"상품명": "대추방울토마토(기획)", "순매출금": 525380, "순수량": 61, "점유율": 7.19}, {"상품명": "샤인머스켓(팩)", "순매출금": 353400, "순수량": 34, "점유율": 4.84}, {"상품명": "사과", "순매출금": 326390, "순수량": 40, "점유율": 4.47}, {"상품명": "바나나(소)", "순매출금": 292500, "순수량": 95, "점유율": 4.0}, {"상품명": "아이스크림바균일가", "순매출금": 237600, "순수량": 528, "점유율": 3.25}, {"상품명": "한돈삼겹살/냉장", "순매출금": 221420, "순수량": 17, "점유율": 3.03}], "주간 빈도별 연관구매": [{"연관구매": ["스낵", "쿠키/비스킷"], "support": 0.024, "lift": 3.487}, {"연관구매": ["맥주", "소주"], "support": 0.021, "lift": 4.466}, {"연관구매": ["곡물과자", "스낵"], "support": 0.018, "lift": 4.925}, {"연관구매": ["스낵", "탄산"], "support": 0.013, "lift": 1.993}, {"연관구매": ["계란", "봉지라면"], "support": 0.01, "lift": 3.0}, {"연관구매": ["곡물과자", "쿠키/비스킷"], "support": 0.01, "lift": 5.07}, {"연관구매": ["권장소비자가", "맥주"], "support": 0.01, "lift": 1.75}, {"연관구매": ["맥주", "스낵"], "support": 0.01, "lift": 1.395}, {"연관구매": ["스낵", "흰우유"], "support": 0.01, "lift": 1.445}, {"연관구매": ["오이", "호박"], "support": 0.01, "lift": 7.41}], "주간 매출별 연관구매": [{"연관구매": ["스낵", "쿠키/비스킷"], "총매출금": 1726400, "발생횟수": 119}, {"연관구매": ["맥주", "소주"], "총매출금": 1376190, "발생횟수": 104}, {"연관구매": ["곡물과자", "스낵"], "총매출금": 1040600, "발생횟수": 71}, {"연관구매": ["탄산", "스낵"], "총매출금": 569290, "발생횟수": 24}, {"연관구매": ["스낵", "흰우유"], "총매출금": 403740, "발생횟수": 18}, {"연관구매": ["계란", "봉지라면"], "총매출금": 291540, "발생횟수": 7}, {"연관구매": ["스낵", "맥주"], "총매출금": 183220, "발생횟수": 7}, {"연관구매": ["곡물과자", "쿠키/비스킷"], "총매출금": 157190, "발생횟수": 7}, {"연관구매": ["호박", "오이"], "총매출금": 153930, "발생횟수": 8}, {"연관구매": ["봉지라면", "스낵"], "총매출금": 150140, "발생횟수": 4}], "주간 객단가별 연관구매": {"20000_under": [{"연관구매": ["스낵", "쿠키/비스킷"], "총매출금": 1726400, "평균 객단가": 14507}, {"연관구매": ["맥주", "소주"], "총매출금": 1376190, "평균 객단가": 13232}, {"연관구매": ["곡물과자", "스낵"], "총매출금": 1040600, "평균 객단가": 14656}], "20000_to_40000": [{"연관구매": ["탄산", "스낵"], "총매출금": 569290, "평균 객단가": 23720}, {"연관구매": ["스낵", "흰우유"], "총매출금": 403740, "평균 객단가": 22430}, {"연관구매": ["스낵", "맥주"], "총매출금": 183220, "평균 객단가": 26174}], "40000_over": [{"연관구매": ["계란", "봉지라면"], "총매출금": 291540, "평균 객단가": 41648}]}, "주간 회원 방문횟수": {"1회": 700, "2회": 280, "3회": 100, "4회": 41, "5회": 27, "6회": 14, "7회": 8, "8회": 4, "9회": 2, "10회 이상": 14}, "주간 회원 성분포": {"남자": 460, "여자": 729}, "주간 회원 연령대": {"10대": 5, "20대": 42, "30대": 108, "40대": 249, "50대": 378, "60대": 237, "70대": 80, "80대": 21}, "주간 회원 Top 10 카테고리": {"계란": 1120460, "봉지라면": 1002450, "스낵": 873610, "흰우유": 799660, "포도": 771770, "맥주": 760240, "쌀(백미)": 742700, "권장소비자가": 719670, "상온즉석식품": 538110, "커피": 515360}, "주간 회원 성별 Top 5 카테고리": {"남": {"쌀(백미)": 535100, "봉지라면": 526380, "계란": 465690, "권장소비자가": 358220, "스낵": 343360}, "선택안함": {"두부": 2890, "흰우유": 1990}, "여": {"계란": 654770, "스낵": 530250, "포도": 516970, "흰우유": 514440, "봉지라면": 476070}}, "주간 회원 나이별 Top 3 카테고리": {"10대": {"돈육(국내산)": 9900, "스낵": 7360, "탄산": 5680}, "20대": {"계란": 83880, "쌀(백미)": 61900, "상온즉석식품": 42370}, "30대": {"계란": 116820, "스낵": 73880, "맥주": 72210}, "40대": {"스낵": 267520, "계란": 259500, "봉지라면": 223570}, "50대": {"계란": 383610, "흰우유": 312200, "맥주": 287700}, "60대": {"봉지라면": 353660, "계란": 163630, "쌀(백미)": 145700}, "70대 이상": {"스낵": 83630, "흰우유": 64030, "포도": 63300}}, "주간 회원 장바구니 통계": {"count": 2231.0, "mean": 10794.782608695652, "std": 11910.127247959415, "min": -44870.0, "25%": 3980.0, "50%": 7950.0, "75%": 13975.0, "max": 195700.0}, "주간 회원 객단가 분포": {"1만미만": 1340, "1만-3만": 744, "3만-5만": 91, "5만이상": 28}};
        const fmt = (n) => new Intl.NumberFormat('ko-KR').format(Math.round(n));
        const fmtWon = (n) => new Intl.NumberFormat('ko-KR', {style:'currency', currency:'KRW'}).format(n);
        
        // 변동폭 포맷 함수
        const fmtChange = (val) => {
            const color = val >= 0 ? 'up' : 'down';
            const arrow = val >= 0 ? '▲' : '▼';
            return `<span class="${color}">${arrow} ${Math.abs(val)}%</span>`;
        };

        // 헤더 세팅
        document.getElementById('doc-title').innerText = data["문서 제목"];
        document.getElementById('doc-meta').innerHTML = `${data["지점명"]} | ${data["주차"]}<br>기간: ${data["주 시작일"]} ~ ${data["주 종료일"]}`;

        // 통계 주입
        const setStat = (id, val, growthId, growthVal, isWon=true) => {
            const targetEl = document.getElementById(id);
            const growthEl = document.getElementById(growthId);

            // 1. 메인 데이터 출력 (값이 있을 때만)
            if (val !== undefined && val !== null) {
                targetEl.innerText = isWon ? fmtWon(val) : fmt(val) + (id.includes('trx') ? '건' : '');
            } else {
                targetEl.innerText = "-"; // JSON에 데이터 자체가 없을 경우
            }

            // 2. 전주 대비 변동폭 출력 (비교값이 있을 때만)
            if (growthVal !== undefined && growthVal !== null && !isNaN(growthVal)) {
                const color = growthVal >= 0 ? 'color:#e74c3c' : 'color:#3498db';
                const arrow = growthVal >= 0 ? '▲' : '▼';
                growthEl.innerHTML = `전주대비 <span style="${color}; font-weight:bold;">${Math.abs(growthVal)}% ${arrow}</span>`;
            } else {
                growthEl.innerHTML = `<span style="color:#999; font-size:0.8rem;">(전주 데이터 없음)</span>`;
            }
        };
        setStat('total-sales', data["주간 총매출"], 'sales-growth', data["전주 대비 매출 상승율"]);
        setStat('avg-daily-sales', data["평균 일일 매출"], 'avg-sales-growth', data["전주 대비 평균 일일 매출 상승율"]);
        setStat('avg-trx', data["평균 일일 거래건수"], 'trx-growth', data["전주 대비 거래건수 상승율"], false);
        setStat('avg-atv', data["평균 일일 객단가"], 'atv-growth', data["전주 대비 객단가 상승율"]);

        // 차트 설정 생략 (기존 코드 유지)
        new Chart(document.getElementById('fiveWeekChart'), {
            type: 'line',
            data: {
                labels: Object.keys(data["5주간 매출 추이"]).map(k => k.split(',')[1]),
                datasets: [{ label: '매출액', data: Object.values(data["5주간 매출 추이"]), borderColor: '#3498db', fill: true, backgroundColor: 'rgba(52, 152, 219, 0.1)', tension: 0.3 }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('dayCompareChart'), {
            type: 'bar',
            data: {
                labels: Object.keys(data["요일별 매출(전 주 비교)"]),
                datasets: [
                    { label: '지난주', data: Object.keys(data["요일별 매출(전 주 비교)"]).map(d => Object.values(data["요일별 매출(전 주 비교)"][d])[0]), backgroundColor: '#bdc3c7' },
                    { label: '이번주', data: Object.keys(data["요일별 매출(전 주 비교)"]).map(d => Object.values(data["요일별 매출(전 주 비교)"][d])[1]), backgroundColor: '#3498db' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('hourlyWeeklyChart'), {
            type: 'bar',
            data: {
                labels: data["주간 시간대별 평균 매출"].map(d => d.시간대),
                datasets: [
                    { label: '평균매출', data: data["주간 시간대별 평균 매출"].map(d=>d.평균매출), backgroundColor: '#b0d7ff', yAxisID: 'y', order: 2 },
                    { label: '평균객단가', data: data["주간 시간대별 평균 매출"].map(d=>d.평균객단가), type: 'line', borderColor: '#e74c3c', borderWidth: 3, yAxisID: 'y1', order: 1 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y1: { position: 'right', grid: { drawOnChartArea: false } } } }
        });

        // 테이블 렌더링
        const renderPivotTable = (tableId, objData) => {
            const tbody = document.querySelector(`#${tableId} tbody`);
            Object.keys(objData).forEach(key => {
                const tr = document.createElement('tr');
                let cells = `<td><strong>${key}</strong></td>`;
                for(let i=0; i<3; i++) {
                    const item = objData[key][i];
                    cells += `<td>${item ? `${item.카테고리 || item.연관구매.join(' + ')}<br><small style="color:#666">(${fmt(item.순매출금 || item.총매출금)}원)</small>` : '-'}</td>`;
                }
                tr.innerHTML = cells;
                tbody.appendChild(tr);
            });
        };

        renderPivotTable('day-top-table', data["요일별 Top5 카테고리"]);
        const hourlyGrouped = data["주간 시간대별 Top3 카테고리"].reduce((acc, curr) => {
            if(!acc[curr.시간대]) acc[curr.시간대] = [];
            acc[curr.시간대].push(curr);
            return acc;
        }, {});
        renderPivotTable('hour-top-table', hourlyGrouped);
        renderPivotTable('atv-assoc-table', data["주간 객단가별 연관구매"]);

        const itemTbody = document.querySelector('#top-item-table tbody');
        data["주간 Top 10 상품"].slice(0, 10).forEach(item => {
            itemTbody.innerHTML += `<tr><td>${item.상품명}</td><td class="text-right">${fmt(item.순매출금)}</td><td class="text-right">${item.순수량}</td></tr>`;
        });

        // --- 변동성 데이터 렌더링 추가 ---
        const volCatTbody = document.querySelector('#vol-cat-table tbody');
        (data["변동성 카테고리 top 5"] || []).forEach(i => {
            volCatTbody.innerHTML += `<tr><td>${i.카테고리}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td></tr>`;
        });

        const volProdTbody = document.querySelector('#vol-prod-table tbody');
        (data["변동성 상품 top 5"] || []).forEach(i => {
            volProdTbody.innerHTML += `<tr><td>${i.상품명}</td><td class="text-right">${i.현재_점유율}%</td><td class="text-right">${fmtChange(i.변동폭)}</td></tr>`;
        });

        // 나머지 차트 및 기능 (기존 유지)
        const freqTbody = document.querySelector('#assoc-freq-table tbody');
        data["주간 빈도별 연관구매"].slice(0, 5).forEach(item => {
            freqTbody.innerHTML += `<tr><td>${item.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${item.support}</td><td class="text-right">${item.lift}</td></tr>`;
        });
        const salesTbody = document.querySelector('#assoc-sales-table tbody');
        data["주간 매출별 연관구매"].slice(0, 5).forEach(item => {
            salesTbody.innerHTML += `<tr><td>${item.연관구매.map(c=>`<span class="badge">${c}</span>`).join('')}</td><td class="text-right">${fmt(item.총매출금)}</td></tr>`;
        });

        const createDoughnut = (id, obj) => {
            new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: { labels: Object.keys(obj), datasets: [{ data: Object.values(obj), backgroundColor: ['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#34495e','#16a085','#27ae60','#2980b9','#8e44ad'] }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });
        };
        const weeklyCatObj = data["주간 Top 10 카테고리 매출"].reduce((a, c) => ({...a, [c.카테고리]: c.순매출금}), {});
        createDoughnut('weeklyCatChart', weeklyCatObj);
        createDoughnut('memberCatChart', data["주간 회원 Top 10 카테고리"]);

        const renderBar = (id, obj, label, color) => {
            new Chart(document.getElementById(id), {
                type: 'bar',
                data: { labels: Object.keys(obj), datasets: [{ label: label, data: Object.values(obj), backgroundColor: color }] },
                options: { responsive: true, maintainAspectRatio: false }
            });
        };
        renderBar('ageChart', data["주간 회원 연령대"], '인원수', '#2ecc71');
        renderBar('visitChart', data["주간 회원 방문횟수"], '방문객수', '#9b59b6');
        renderBar('atvDistChart', data["주간 회원 객단가 분포"], '건수', '#f39c12');

        const bs = data["주간 회원 장바구니 통계"];
        document.getElementById('basket-container').innerHTML = `
            <div style="font-size: 1.1rem; margin-bottom: 10px;">분석 대상 총 수량: <strong>${fmt(bs.count)}</strong>개</div>
            <div class="basket-grid">
                <div class="basket-item"><div class="basket-label">평균(객단가)</div><div class="basket-val">${fmtWon(bs.mean)}</div></div>
                <div class="basket-item"><div class="basket-label">25% (하위)</div><div class="basket-val">${fmtWon(bs['25%'])}</div></div>
                <div class="basket-item"><div class="basket-label">50% (중앙)</div><div class="basket-val">${fmtWon(bs['50%'])}</div></div>
                <div class="basket-item"><div class="basket-label">75% (상위)</div><div class="basket-val">${fmtWon(bs['75%'])}</div></div>
                <div class="basket-item"><div class="basket-label">Max</div><div class="basket-val">${fmtWon(bs['max'])}</div></div>
            </div>
        `;

        const ageTbody = document.querySelector('#age-cat-table tbody');
        Object.keys(data["주간 회원 나이별 Top 3 카테고리"]).forEach(age => {
            const cats = data["주간 회원 나이별 Top 3 카테고리"][age];
            let row = `<td><strong>${age}</strong></td>`;
            Object.keys(cats).slice(0,3).forEach(c => row += `<td>${c}<br><small style="color:#666">(${fmt(cats[c])}원)</small></td>`);
            ageTbody.innerHTML += `<tr>${row}</tr>`;
        });
    </script>
</body>
</html>